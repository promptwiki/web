---
interface Props {
  title?: string;
  lang?: 'ko' | 'en';
}

const { title = 'PromptWiki', lang = 'ko' } = Astro.props;
const siteTitle = title === 'PromptWiki' ? 'PromptWiki' : `${title} — PromptWiki`;
const base = import.meta.env.BASE_URL.replace(/\/$/, '');

const nav = {
  ko: { projects: '프로젝트', github: 'GitHub', search: '검색...' },
  en: { projects: 'Projects', github: 'GitHub', search: 'Search...' },
}[lang];

const description = {
  ko: 'AI와 만드는 법을, 모두와 나눈다. 제품 개발 과정을 기록하고 공유하는 플랫폼.',
  en: 'Share how you build with AI. A platform to record and share your product development journey.',
}[lang];
---

<!doctype html>
<html lang={lang} class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <title>{siteTitle}</title>
    <link rel="icon" type="image/svg+xml" href={`${base}/favicon.svg`} />
    <!-- Pagefind styles -->
    <link href={`${base}/pagefind/pagefind-ui.css`} rel="stylesheet" />
  </head>
  <body class="bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100 min-h-screen flex flex-col">
    <header class="border-b border-gray-200 dark:border-gray-800 sticky top-0 bg-white/95 dark:bg-gray-950/95 backdrop-blur z-50">
      <div class="max-w-6xl mx-auto px-4 h-14 flex items-center justify-between gap-3">
        <a href={`${base}/${lang}`} class="font-bold text-lg text-brand-600 dark:text-brand-400 hover:opacity-80 transition-opacity shrink-0">
          PromptWiki
        </a>

        <!-- Search trigger -->
        <button
          id="search-trigger"
          class="hidden sm:flex items-center gap-2 flex-1 max-w-xs px-3 py-1.5 text-sm text-gray-400 dark:text-gray-500 bg-gray-100 dark:bg-gray-800 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"
          aria-label="Search"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
          {nav.search}
          <span class="ml-auto text-xs bg-gray-200 dark:bg-gray-700 px-1.5 py-0.5 rounded">⌘K</span>
        </button>

        <nav class="flex items-center gap-3 sm:gap-5 text-sm font-medium">
          <!-- Mobile search icon -->
          <button id="search-trigger-mobile" class="sm:hidden text-gray-500 dark:text-gray-400" aria-label="Search">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
          </button>
          <a href={`${base}/${lang}`} class="hidden sm:block text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors">
            {nav.projects}
          </a>
          <a
            href="https://github.com/promptwiki"
            target="_blank"
            rel="noopener noreferrer"
            class="hidden sm:flex items-center gap-1 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors"
          >
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M12 2C6.477 2 2 6.477 2 12c0 4.42 2.865 8.17 6.839 9.49.5.092.682-.217.682-.482 0-.237-.008-.866-.013-1.7-2.782.604-3.369-1.34-3.369-1.34-.454-1.156-1.11-1.464-1.11-1.464-.908-.62.069-.608.069-.608 1.003.07 1.531 1.03 1.531 1.03.892 1.529 2.341 1.087 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.11-4.555-4.943 0-1.091.39-1.984 1.029-2.683-.103-.253-.446-1.27.098-2.647 0 0 .84-.269 2.75 1.025A9.578 9.578 0 0112 6.836c.85.004 1.705.115 2.504.337 1.909-1.294 2.747-1.025 2.747-1.025.546 1.377.203 2.394.1 2.647.64.699 1.028 1.592 1.028 2.683 0 3.842-2.339 4.687-4.566 4.935.359.309.678.919.678 1.852 0 1.336-.012 2.415-.012 2.743 0 .267.18.578.688.48C19.138 20.167 22 16.418 22 12c0-5.523-4.477-10-10-10z" />
            </svg>
            {nav.github}
          </a>
          <!-- Dark mode toggle -->
          <button id="theme-toggle" class="text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors" aria-label="Toggle dark mode">
            <svg id="icon-sun" class="w-5 h-5 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
            </svg>
            <svg id="icon-moon" class="w-5 h-5 block dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
            </svg>
          </button>
          <a
            href={lang === 'ko' ? `${base}/en` : `${base}/ko`}
            class="text-xs px-2 py-1 rounded border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
          >
            {lang === 'ko' ? 'EN' : 'KO'}
          </a>
        </nav>
      </div>
    </header>

    <!-- Search modal -->
    <div id="search-modal" class="fixed inset-0 z-[100] hidden">
      <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" id="search-backdrop"></div>
      <div class="relative max-w-xl mx-auto mt-20 px-4">
        <div class="bg-white dark:bg-gray-900 rounded-xl shadow-2xl overflow-hidden border border-gray-200 dark:border-gray-700">
          <div id="search-container" class="p-4"></div>
        </div>
      </div>
    </div>

    <main class="flex-1">
      <slot />
    </main>

    <footer class="border-t border-gray-200 dark:border-gray-800 py-8 mt-16">
      <div class="max-w-5xl mx-auto px-4 text-center text-sm text-gray-500 dark:text-gray-400">
        <p class="mb-2">
          <span class="font-medium text-gray-700 dark:text-gray-300">PromptWiki</span>
          — {lang === 'ko' ? 'AI와 만드는 법을, 모두와 나눈다' : 'Share how you build with AI'}
        </p>
        <p>
          CC BY-SA 4.0 ·
          <a href="https://github.com/promptwiki" target="_blank" rel="noopener noreferrer" class="hover:underline">GitHub</a>
        </p>
      </div>
    </footer>

    <!-- Pagefind JS -->
    <script src={`${base}/pagefind/pagefind-ui.js`} is:inline></script>
    <script is:inline define:vars={{ base }}>
      // Dark mode
      const root = document.documentElement;
      const stored = localStorage.getItem('theme');
      if (stored === 'dark' || (!stored && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        root.classList.add('dark');
      }
      document.getElementById('theme-toggle')?.addEventListener('click', () => {
        root.classList.toggle('dark');
        localStorage.setItem('theme', root.classList.contains('dark') ? 'dark' : 'light');
      });

      // Search modal
      let searchInitialized = false;
      const modal = document.getElementById('search-modal');
      const backdrop = document.getElementById('search-backdrop');

      function openSearch() {
        modal?.classList.remove('hidden');
        if (!searchInitialized && typeof PagefindUI !== 'undefined') {
          new PagefindUI({
            element: '#search-container',
            baseUrl: base || '/',
            resetStyles: false,
          });
          searchInitialized = true;
        }
        setTimeout(() => document.querySelector('.pagefind-ui__search-input')?.focus(), 50);
      }
      function closeSearch() { modal?.classList.add('hidden'); }

      document.getElementById('search-trigger')?.addEventListener('click', openSearch);
      document.getElementById('search-trigger-mobile')?.addEventListener('click', openSearch);
      backdrop?.addEventListener('click', closeSearch);
      document.addEventListener('keydown', (e) => {
        if ((e.metaKey || e.ctrlKey) && e.key === 'k') { e.preventDefault(); openSearch(); }
        if (e.key === 'Escape') closeSearch();
      });
    </script>
  </body>
</html>
